import { Callout, Tabs } from 'nextra/components'

# Odds Stream

Real-time odds updates via Server-Sent Events (SSE).

```
GET /api/v1/stream/odds
```

<Callout type="warning">
**WebSocket Add-on Required**: This endpoint requires the WebSocket add-on ($99/mo) on any paid tier.
</Callout>

## Query Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `league` | string | Filter by league (e.g., `nba,nfl`) |
| `sportsbook` | string | Filter by sportsbooks (e.g., `draftkings,pinnacle`) |
| `sport` | string | Filter by sport |
| `live` | boolean | Only live events |
| `api_key` | string | API key (for browser EventSource) |

## Connection Limits

| Tier | Concurrent Streams |
|------|-------------------|
| Free | Not available |
| Hobby + Add-on | 10 |
| Pro + Add-on | 10 |
| Sharp + Add-on | 10 |
| Enterprise | Custom |

## Event Types

### `initial`

Sent immediately on connection with full odds snapshot.

```json
{
  "type": "initial",
  "timestamp": "2026-01-26T02:30:00.000Z",
  "data": [
    {
      "id": "draftkings_33483153_moneyline_PHO",
      "sportsbook": "draftkings",
      "odds": { "american": -150, "decimal": 1.667 }
    }
  ],
  "meta": {
    "count": 3095
  }
}
```

### `odds_update`

Sent when odds change for a sportsbook.

```json
{
  "type": "odds_update",
  "timestamp": "2026-01-26T02:30:15.000Z",
  "source": "draftkings",
  "data": [
    {
      "id": "draftkings_33483153_spread_PHO",
      "odds": { "american": -108, "decimal": 1.926 }
    }
  ]
}
```

### `heartbeat`

Sent every 30 seconds to keep connection alive.

```json
{
  "type": "heartbeat",
  "timestamp": "2026-01-26T02:31:00.000Z"
}
```

## Example Requests

<Tabs items={['JavaScript', 'Python', 'Node.js']}>
  <Tabs.Tab>
```javascript
const url = new URL('https://api.sharpapi.io/api/v1/stream/odds');
url.searchParams.set('api_key', 'YOUR_KEY');
url.searchParams.set('league', 'nba,nfl');

const eventSource = new EventSource(url);

eventSource.addEventListener('initial', (e) => {
  const { data, meta } = JSON.parse(e.data);
  console.log(`Received ${meta.count} initial odds`);
});

eventSource.addEventListener('odds_update', (e) => {
  const { source, data, timestamp } = JSON.parse(e.data);
  console.log(`[${timestamp}] ${source} updated ${data.length} odds`);
});

eventSource.addEventListener('heartbeat', () => {
  console.log('Connection alive');
});

eventSource.onerror = (e) => {
  console.log('Connection error, will auto-reconnect');
};
```
  </Tabs.Tab>
  <Tabs.Tab>
```python
import json
import sseclient
import requests

def stream_odds(api_key, league=None):
    url = 'https://api.sharpapi.io/api/v1/stream/odds'
    params = {'league': league} if league else {}
    headers = {'X-API-Key': api_key}

    response = requests.get(url, params=params, headers=headers, stream=True)
    client = sseclient.SSEClient(response)

    for event in client.events():
        data = json.loads(event.data)

        if event.event == 'initial':
            print(f"Initial: {data['meta']['count']} odds")

        elif event.event == 'odds_update':
            book = data['source']
            print(f'Update from {book}: {len(data["data"])} odds')

stream_odds('YOUR_KEY', league='nba,nfl')
```
  </Tabs.Tab>
  <Tabs.Tab>
```typescript
import EventSource from 'eventsource';

const es = new EventSource(
  'https://api.sharpapi.io/api/v1/stream/odds?league=nba',
  { headers: { 'X-API-Key': 'YOUR_KEY' } }
);

es.addEventListener('initial', (e) => {
  const { data, meta } = JSON.parse(e.data);
  console.log(`Received ${meta.count} initial odds`);
});

es.addEventListener('odds_update', (e) => {
  const { source, data } = JSON.parse(e.data);
  console.log(`${source}: ${data.length} odds updated`);
});
```
  </Tabs.Tab>
</Tabs>

## Filtering

Use query parameters to reduce bandwidth:

```javascript
// Only NBA odds from DraftKings
const url = 'https://api.sharpapi.io/api/v1/stream/odds?league=nba&sportsbook=draftkings&api_key=KEY';
```

<Callout type="info">
Filtering happens server-side, so you only receive relevant updates.
</Callout>

## Reconnection

EventSource automatically reconnects on disconnect. To resume from where you left off, the server sends a `Last-Event-ID` which EventSource automatically uses on reconnection.

```javascript
// The browser handles this automatically, but you can check the ID:
eventSource.addEventListener('message', (e) => {
  console.log('Last Event ID:', e.lastEventId);
});
```

## Error Handling

```javascript
eventSource.onerror = (error) => {
  if (eventSource.readyState === EventSource.CLOSED) {
    console.log('Stream closed permanently');
    // You may need to create a new EventSource
  } else if (eventSource.readyState === EventSource.CONNECTING) {
    console.log('Reconnecting...');
  }
};
```
